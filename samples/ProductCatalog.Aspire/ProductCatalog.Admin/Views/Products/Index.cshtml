@model List<ProductCatalog.Shared.Dtos.ProductDto>
@{
    ViewData["Title"] = "Product Management";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Product Catalog Admin</h1>
        <a asp-action="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create New Product
        </a>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Success!</strong> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">All Products (@Model.Count)</h5>
        </div>
        <div class="card-body">
            @if (Model.Any())
            {
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>SKU</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model)
                        {
                            <tr>
                                <td>@product.Id</td>
                                <td>@product.Name</td>
                                <td><code>@product.Sku</code></td>
                                <td><span class="badge bg-secondary">@product.Category</span></td>
                                <td>$@product.Price.ToString("N2")</td>
                                <td>@product.StockQuantity</td>
                                <td>
                                    @if (product.IsActive)
                                    {
                                        <span class="badge bg-success">Active</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Inactive</span>
                                    }
                                </td>
                                <td>
                                    <a asp-action="Edit" asp-route-id="@product.Id" class="btn btn-sm btn-warning">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>
                                    <form asp-action="Delete" asp-route-id="@product.Id" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-danger"
                                                onclick="return confirm('Are you sure you want to delete this product?')">
                                            <i class="bi bi-trash"></i> Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No products found.
                    <a asp-action="Create">Create your first product</a>.
                </div>
            }
        </div>
    </div>

    <div class="alert alert-info mt-4">
        <strong>Cache Synchronization:</strong> When you create, update, or delete products here,
        the changes are automatically synchronized to the API service via Redis backplane.
        The API's FusionCache will invalidate stale entries and fetch fresh data on the next request.
    </div>
</div>
